<div class="container-fluid min-vh-100 d-flex flex-column p-0">

  <app-header></app-header>

  <div class="d-flex flex-column flex-md-row p-0">

    <!-- CÃ´tÃ© gauche : sÃ©lection date + top 3 -->
    <div class="col-12 col-md-3 d-flex flex-column p-4 bg-body text-body">
      <h4>Rapport thermique</h4>

      <!-- Date dÃ©but / fin -->
      <div class="mb-4">
        <div class="mb-3">
          <label class="form-label">Date dÃ©but</label>
          <input type="date"
                 class="form-control"
                 [(ngModel)]="startDate"
                 (change)="onStartDateChange()"
                 [max]="endDate">
        </div>
        <div class="mb-3">
          <label class="form-label">Date fin</label>
          <input type="date"
                 class="form-control"
                 [(ngModel)]="endDate"
                 (change)="onEndDateChange()"
                 [min]="startDate">
        </div>
      </div>

      <!-- Top 3 salles - Podium -->
      <div>
        <h5 class="mb-3">Top 3 dÃ©perditions</h5>
        <div class="d-flex justify-content-center align-items-end gap-3 mt-4">
          @for (top of topRooms; track top.room.idRoom; let i = $index) {
            <div class="text-center">
              <!-- Badge classement -->
              <div class="mb-2 fw-bold">
                @if (i === 0) { ðŸ¥‡ 1er }
                @else if (i === 1) { ðŸ¥ˆ 2e }
                @else { ðŸ¥‰ 3e }
              </div>

              <!-- Bloc podium -->
              <div class="podium-box shadow rounded d-flex flex-column justify-content-center px-3"
                   [class.first]="i === 0"
                   [class.second]="i === 1"
                   [class.third]="i === 2">
                <strong>{{ top.room.nameRoom }}</strong>
                <span class="badge bg-danger mt-1">
                  {{ top.loss | number:'1.0-0' }}
                </span>
              </div>
            </div>
          }
        </div>
      </div>

    </div>

    <!-- CÃ´tÃ© droit : graphiques des 3 salles -->
    <div class="col-12 col-md-9 d-flex flex-column p-4">
      @for (top of topRooms; track top.room.idRoom) {
        <div class="card p-3 mb-3">
          <h5>{{ top.room.nameRoom }} â€“ DÃ©perdition: {{ top.loss | number:'1.0-0' }}</h5>

          <div class="d-flex flex-column gap-3">

            <!-- Graph TempÃ©rature -->
            <app-sensor-graph
              [room]="top.room"
              valueKey="valueTemp"
              [hours]="24"
              [color]="getSensorColor('Temperature')"
              style="height:300px; width:100%;">
            </app-sensor-graph>

            <!-- Graph CO2 -->
            <app-sensor-graph
              [room]="top.room"
              valueKey="valueCO2"
              [hours]="24"
              [color]="getSensorColor('CO2')"
              style="height:300px; width:100%;">
            </app-sensor-graph>

            <!-- Graph HumiditÃ© -->
            <app-sensor-graph
              [room]="top.room"
              valueKey="valueHum"
              [hours]="24"
              [color]="getSensorColor('Humidity')"
              style="height:300px; width:100%;">
            </app-sensor-graph>

          </div>
        </div>
      }

    </div>

  </div>

  <app-footer></app-footer>

</div>
